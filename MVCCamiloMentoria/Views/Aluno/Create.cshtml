@model MVCCamiloMentoria.ViewModels.AlunoViewModel

<div class="container py-4">
	<div class="row justify-content-center">
		<div class="col-lg-10">
			<div class="d-flex justify-content-between align-items-center mb-4">
				<h2 class="mb-0 text-primary">
					<i class="fas fa-user-plus me-2"></i>Cadastro de Aluno
				</h2>
				<a asp-action="Index" class="btn btn-outline-secondary">
					<i class="fas fa-arrow-left me-1"></i> Voltar
				</a>
			</div>

			<div class="card border-0 shadow-sm mb-4">
				<div class="card-body p-0">
					<form asp-action="Create" class="needs-validation" novalidate>
						<div asp-validation-summary="ModelOnly" class="alert alert-danger mx-3 mt-3"></div>

						<!-- Seção Informações Pessoais -->
						<div class="card mb-4 border-0">
							<div class="card-header bg-primary text-white py-3">
								<h5 class="mb-0">
									<i class="fas fa-id-card me-2"></i>Informações Pessoais
								</h5>
							</div>
							<div class="card-body px-4 py-3">
								<div class="row g-3">
									<div class="col-md-8">
										<div class="form-group mb-3">
											<label asp-for="Nome" class="form-label fw-semibold"></label>
											<input asp-for="Nome" class="form-control rounded-3 py-2" placeholder="Nome completo do aluno" />
											<span asp-validation-for="Nome" class="text-danger small"></span>
										</div>
									</div>
									<div class="col-md-4">
										<div class="form-group mb-3">
											<label asp-for="DataNascimento" class="form-label fw-semibold"></label>
											<input asp-for="DataNascimento" type="date" class="form-control rounded-3 py-2" />
											<span asp-validation-for="DataNascimento" class="text-danger small"></span>
										</div>
									</div>
								</div>

								<div class="form-group mb-3">
									<label asp-for="EmailEscolar" class="form-label fw-semibold"></label>
									<input asp-for="EmailEscolar" class="form-control rounded-3 py-2" placeholder="exemplo@escola.com" />
									<span asp-validation-for="EmailEscolar" class="text-danger small"></span>
								</div>
							</div>
						</div>

						<!-- Seção Responsáveis -->
						<div class="card mb-4 border-0">
							<div class="card-header bg-primary text-white py-3">
								<h5 class="mb-0">
									<i class="fas fa-users me-2"></i>Responsáveis
								</h5>
							</div>

							<div class="card-body px-4 py-3">
								<div class="row g-3">
									<div class="col-md-6">
										<div class="form-group mb-3">
											<label asp-for="NomeResponsavel1" class="form-label fw-semibold"></label>
											<input asp-for="NomeResponsavel1" class="form-control rounded-3 py-2" placeholder="Nome do primeiro responsável" />
											<span asp-validation-for="NomeResponsavel1" class="text-danger small"></span>
										</div>
									</div>
									<div class="col-md-6">
										<div class="form-group mb-3">
											<label asp-for="Parentesco1" class="form-label fw-semibold"></label>
											<select asp-for="Parentesco1" asp-items="Model.ParentescoOptions"
													class="form-select rounded-3 py-2">
												<option value="">-- Selecione --</option>
											</select>
											<span asp-validation-for="Parentesco1" class="text-danger small"></span>
										</div>
									</div>
								</div>

								<div class="row g-3">
									<div class="col-md-6">
										<div class="form-group mb-3">
											<label asp-for="NomeResponsavel2" class="form-label fw-semibold"></label>
											<input asp-for="NomeResponsavel2" class="form-control rounded-3 py-2" placeholder="Nome do segundo responsável (opcional)" />
											<span asp-validation-for="NomeResponsavel2" class="text-danger small"></span>
										</div>
									</div>
									<div class="col-md-6">
										<div class="form-group mb-3">
											<label asp-for="Parentesco2" class="form-label fw-semibold"></label>
											<select asp-for="Parentesco2" asp-items="Model.ParentescoOptions"
													class="form-select rounded-3 py-2">
												<option value="">-- Selecione --</option>
											</select>
											<span asp-validation-for="Parentesco2" class="text-danger small"></span>
										</div>
									</div>
								</div>
							</div>
						</div>

						<!-- Seção Matrícula -->
						<div class="card mb-4 border-0">
							<div class="card-header bg-primary text-white py-3">
								<h5 class="mb-0">
									<i class="fas fa-graduation-cap me-2"></i>Matrícula
								</h5>
							</div>
							<div class="card-body px-4 py-3">
								<div class="row g-3">
									<div class="col-md-6">
										<div class="form-group mb-3">
											<label asp-for="AnoInscricao" class="form-label fw-semibold"></label>
											<input asp-for="AnoInscricao" class="form-control rounded-3 py-2" placeholder="Ano de ingresso" />
											<span asp-validation-for="AnoInscricao" class="text-danger small"></span>
										</div>
									</div>
									<div class="col-md-6 d-flex align-items-center">
										<div class="form-check form-switch mt-3">
											<input class="form-check-input" type="checkbox" role="switch" asp-for="BolsaEscolar" />
											<label class="form-check-label fw-semibold" asp-for="BolsaEscolar"></label>
										</div>
									</div>
								</div>

								<div class="row g-3">
									<div class="col-md-6">
										<div class="form-group mb-3">
											<label asp-for="TurmaId" class="form-label fw-semibold"></label>
											<select asp-for="TurmaId" class="form-select rounded-3 py-2" asp-items="ViewBag.TurmaId">
												<option value="">-- Selecione a turma --</option>
											</select>
											<span asp-validation-for="TurmaId" class="text-danger small"></span>
										</div>
									</div>

									<div class="col-md-6">
										<div class="form-group mb-3">
											<label asp-for="EscolaId" class="form-label fw-semibold"></label>
											<select asp-for="EscolaId" class="form-select rounded-3 py-2" asp-items="ViewBag.EscolaId">
												<option value="">-- Selecione a escola --</option>
											</select>
											<span asp-validation-for="EscolaId" class="text-danger small"></span>
										</div>
									</div>
								</div>
							</div>
						</div>

						<!-- Seção Telefones -->
						<div class="card mb-4 border-0">
							<div class="card-header bg-primary text-white py-3">
								<h5 class="mb-0">
									<i class="fas fa-phone me-2"></i>Telefones
								</h5>
							</div>
							<div class="card-body px-4 py-3">
								@for (int i = 0; i < Model.Telefone!.Count; i++)
								{
									<div class="row g-3 mb-3">
										<div class="col-md-4">
											<div class="form-group">
												<label asp-for="Telefone[@i].Telefone.DDD" class="form-label fw-semibold">DDD</label>
												<input asp-for="Telefone[@i].Telefone.DDD" class="form-control rounded-3 py-2" placeholder="DDD" />
												<span asp-validation-for="Telefone[@i].Telefone.DDD" class="text-danger small"></span>
											</div>
										</div>
										<div class="col-md-8">
											<div class="form-group">
												<label asp-for="Telefone[@i].Telefone.Numero" class="form-label fw-semibold">Número</label>
												<input asp-for="Telefone[@i].Telefone.Numero" class="form-control rounded-3 py-2" placeholder="Número do telefone" />
												<span asp-validation-for="Telefone[@i].Telefone.Numero" class="text-danger small"></span>
											</div>
										</div>
									</div>
								}
							</div>
						</div>

						<!-- Seção Endereço -->
						<div class="card mb-4 border-0">
							<div class="card-header bg-primary text-white py-3">
								<h5 class="mb-0">
									<i class="fas fa-map-marker-alt me-2"></i>Endereço
								</h5>
							</div>
							<div class="card-body px-4 py-3">
								<div class="row g-3">
									<div class="col-md-8">

										<div class="form-group mb-3">
											<label asp-for="Endereco.CEP" class="form-label fw-semibold">CEP</label>
											<div class="input-group">
												<input asp-for="Endereco.CEP" class="form-control rounded-3 py-2" id="Endereco_CEP" placeholder="00000-000" />
											</div>
											<span asp-validation-for="Endereco.CEP" class="text-danger small"></span>
										</div>


										<div class="form-group mb-3">
											<label asp-for="Endereco.Cidade" class="form-label fw-semibold">Cidade</label>
											<input asp-for="Endereco.Cidade" class="form-control rounded-3 py-2" id="Endereco_Cidade"  />
											<span asp-validation-for="Endereco.Cidade" class="text-danger small"></span>
										</div>

	
										<div class="form-group mb-3">
											<label asp-for="Endereco.Bairro" class="form-label fw-semibold">Bairro</label>
											<input asp-for="Endereco.Bairro" class="form-control rounded-3 py-2" id="Endereco_Bairro"  />
											<span asp-validation-for="Endereco.Bairro" class="text-danger small"></span>
										</div>


										<div class="form-group mb-3">
											<label asp-for="Endereco.NomeRua" class="form-label fw-semibold">Rua</label>
											<input asp-for="Endereco.NomeRua" class="form-control rounded-3 py-2" id="Endereco_NomeRua" placeholder="Nome da rua" />
											<span asp-validation-for="Endereco.NomeRua" class="text-danger small"></span>
										</div>
									</div>
									<div class="col-md-4">

										<div class="form-group mb-3">
											<label asp-for="Endereco.NumeroRua" class="form-label fw-semibold">Número</label>
											<input asp-for="Endereco.NumeroRua" class="form-control rounded-3 py-2" id="Endereco_NumeroRua" placeholder="Nº" />
											<span asp-validation-for="Endereco.NumeroRua" class="text-danger small"></span>
										</div>
									</div>
								</div>

								<div class="form-group mb-3">
									<label asp-for="Endereco.Complemento" class="form-label fw-semibold">Complemento</label>
									<input asp-for="Endereco.Complemento" class="form-control rounded-3 py-2" id="Endereco_Complemento" placeholder="Apto, bloco, etc." />
									<span asp-validation-for="Endereco.Complemento" class="text-danger small"></span>
								</div>


								<div class="form-group">
									<label>Estado</label>
									@Html.DropDownListFor(model => model.Endereco.EstadoId ,
									(SelectList)ViewBag.Estados,
																		"Selecione um estado",
																		new { @class = "form-control", id = "Estado", disabled = "disabled" }) 
								</div>
							</div>
						</div>


						<!-- Botões de Ação -->
						<div class="d-flex justify-content-between mt-4">
							<a asp-action="Index" class="btn btn-outline-secondary rounded-3 px-4 py-2">
								<i class="fas fa-times me-2"></i>Cancelar
							</a>
							<button type="submit" class="btn btn-primary rounded-3 px-4 py-2">
								<i class="fas fa-save me-2"></i>Cadastrar Aluno
							</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
</div>
<style>
	.card {
		border-radius: 12px;
		box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
		margin-bottom: 1.5rem;
		border: 1px solid rgba(0, 0, 0, 0.08);
	}

	.card-header {
		border-radius: 12px 12px 0 0 !important;
	}

	.form-control, .form-select {
		transition: all 0.3s;
		border: 1px solid #ced4da;
	}

		.form-control:focus, .form-select:focus {
			border-color: #86b7fe;
			box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.15);
		}

	.btn {
		transition: all 0.3s;
	}

	.form-label {
		font-weight: 500;
		color: #495057;
	}

	.input-group-text {
		background-color: #f8f9fa;
	}
</style>
@section Scripts {
	@{
		await Html.RenderPartialAsync("_ValidationScriptsPartial");
	}
}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
	$(document).ready(function() {
		$('#Endereco_CEP').blur(function() {
			const cep = $(this).val().replace(/\D/g, '');
			if (cep.length !== 8) return;


			$.getJSON(`/api/cep/${cep}`, function(data) {
				// console.log("Dados da API:", data);


				if (data.logradouro) {
					$("#Endereco_NomeRua").val(data.logradouro).trigger('change');
				}

				if (data.localidade) {
					$("#Endereco_Cidade").val(data.localidade).trigger('change');
				}

				if (data.bairro) {
					$("#Endereco_Bairro").val(data.bairro).trigger('change');
				}


				const estadoSelect = $("#Estado");
				if (data.uf || data.estado) {
					const estadoParaBuscar = data.estado || data.uf;
					const estadoEncontrado = estadoSelect.find("option").filter(function() {
						return $(this).text().trim() === estadoParaBuscar;
					}).val();

					if (estadoEncontrado) {
						estadoSelect.val(estadoEncontrado).trigger('change');
					} else {
						console.warn("Estado não encontrado:", estadoParaBuscar);
					}
				}
			}).fail(function() {
				alert('CEP não encontrado ou erro na consulta!');

				$("#Endereco_NomeRua, #Endereco_Cidade").val('');
				$("#Estado").val('');
			});
		});
	});
</script>